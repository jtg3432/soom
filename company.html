<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>업체 정보 - 운영관리팀</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .page-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .page-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            text-align: center;
            padding: 40px 20px;
            position: relative;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .add-btn, .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-left: 10px;
        }

        .add-btn:hover, .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .content {
            padding: 30px;
            position: relative;
        }

        .search-bar {
            width: 100%;
            padding: 12px 20px;
            margin-bottom: 20px;
            border-radius: 25px;
            border: 1px solid #ddd;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .search-bar:focus {
            outline: none;
            border-color: #667eea;
        }

        .company-list {
            display: grid;
            gap: 20px;
        }

        .company-row {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s;
            position: relative;
        }

        .company-row:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .info-container {
            flex-grow: 1;
        }

        .company-name {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .company-category, .company-contact {
            font-size: 0.9rem;
            color: #777;
        }

        .company-contact {
            margin-top: 5px;
        }

        .company-contact a {
            color: #667eea;
            text-decoration: none;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-left: 20px;
        }

        .edit-btn, .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            opacity: 0.6;
            transition: opacity 0.3s;
        }

        .edit-btn:hover, .delete-btn:hover {
            opacity: 1;
        }

        .edit-btn { color: #5cb85c; }
        .delete-btn { color: #d9534f; }
        
        /* 모달 스타일 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-content input, .modal-content textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 10px;
        }

        .modal-content button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
        }

        .modal-content button:hover {
            background: #5a6cdb;
        }

        .feedback {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            z-index: 1000;
        }

        .feedback.show {
            opacity: 1;
        }

        /* 체크박스와 뱃지 스타일 */
        .status-cell {
            display: flex;
            align-items: center;
            margin-left: 20px;
        }

        .in-progress-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            background-color: #e74c3c;
            border-radius: 50%;
            display: none; /* 기본적으로 숨김 */
        }
        
        .in-progress-badge.visible {
            display: block;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="page-header">
            <div class="header-buttons">
                <a href="index.html" class="back-btn">← 메인으로</a>
                <button id="addBtn" class="add-btn">+ 업체 추가</button>
            </div>
            <h1>업체 정보</h1>
            <p>운영관리팀에서 관리하는 모든 업체의 정보입니다.</p>
        </div>
        <div class="content">
            <input type="text" id="searchInput" class="search-bar" placeholder="업체 이름으로 검색...">
            <div id="companyList" class="company-list">
                </div>
        </div>
    </div>
    
    <div id="companyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">업체 정보 추가</h2>
            <form id="companyForm">
                <input type="hidden" id="companyId">
                <input type="text" id="nameInput" placeholder="업체명" required>
                <input type="text" id="categoryInput" placeholder="카테고리 (예: 영상, 마케팅, 디자인 등)" required>
                <input type="email" id="emailInput" placeholder="이메일">
                <input type="tel" id="telInput" placeholder="전화번호 (예: 010-1234-5678)">
                <textarea id="memoInput" placeholder="메모" rows="4"></textarea>
                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <input type="checkbox" id="inProgressCheckbox" style="width: auto; margin-right: 10px;">
                    <label for="inProgressCheckbox" style="margin: 0; font-size: 1rem;">진행 중인 업체입니다.</label>
                </div>
                <button type="submit" id="saveBtn">저장</button>
            </form>
        </div>
    </div>

    <div id="saveFeedback" class="feedback"></div>

    <script>
        const searchInput = document.getElementById('searchInput');
        const companyList = document.getElementById('companyList');

        function showSaveFeedback(message) {
            const feedback = document.getElementById('saveFeedback');
            feedback.textContent = message;
            feedback.classList.add('show');
            
            setTimeout(() => {
                feedback.classList.remove('show');
            }, 2000);
        }

        function openAddModal() {
            document.getElementById('companyForm').reset();
            document.getElementById('companyId').value = '';
            document.getElementById('modalTitle').textContent = '업체 정보 추가';
            document.getElementById('companyModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('companyModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('companyModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                openAddModal();
            }
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyA6VSdpxQ2PDkCrezW5n_Y69BVuvA3ig9g",
            authDomain: "soom-brand.firebaseapp.com",
            projectId: "soom-brand",
            storageBucket: "soom-brand.firebasestorage.app",
            messagingSenderId: "765427036681",
            appId: "1:765427036681:web:37add5f9e4fdb03565f6f3"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const companiesCol = collection(db, 'companies');
        
        const companyForm = document.getElementById('companyForm');

        function displayCompanies(querySnapshot) {
            const companyList = document.getElementById('companyList');
            companyList.innerHTML = '';
            querySnapshot.forEach(doc => {
                const company = doc.data();
                const row = document.createElement('div');
                row.className = 'company-row';
                row.dataset.id = doc.id;

                const statusCell = document.createElement('div');
                statusCell.className = 'status-cell';
                const statusCheckbox = document.createElement('input');
                statusCheckbox.type = 'checkbox';
                statusCheckbox.checked = company.inProgress || false;
                statusCheckbox.onchange = () => toggleInProgress(doc.id, statusCheckbox.checked);

                const infoContainer = document.createElement('div');
                infoContainer.className = 'info-container';

                const nameElement = document.createElement('div');
                nameElement.className = 'company-name';
                nameElement.textContent = company.name;
                
                const badge = document.createElement('span');
                badge.className = 'in-progress-badge';
                if (company.inProgress) {
                    badge.classList.add('visible');
                }
                
                nameElement.appendChild(badge);

                const categoryElement = document.createElement('div');
                categoryElement.className = 'company-category';
                categoryElement.textContent = company.category;

                const contactElement = document.createElement('div');
                contactElement.className = 'company-contact';
                contactElement.innerHTML = 
                    (company.email ? `이메일: <a href="mailto:${company.email}">${company.email}</a><br>` : '') +
                    (company.tel ? `전화번호: <a href="tel:${company.tel}">${company.tel}</a>` : '');

                const memoElement = document.createElement('div');
                memoElement.className = 'company-memo';
                memoElement.textContent = company.memo;
                
                const actionButtons = document.createElement('div');
                actionButtons.className = 'action-buttons';

                const editBtn = document.createElement('button');
                editBtn.className = 'edit-btn';
                editBtn.innerHTML = '&#9998;';
                editBtn.onclick = () => openEditModal(doc.id, company);

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = '&#10006;';
                deleteBtn.onclick = () => deleteCompany(doc.id);

                infoContainer.appendChild(nameElement);
                infoContainer.appendChild(categoryElement);
                infoContainer.appendChild(contactElement);
                infoContainer.appendChild(memoElement);
                
                actionButtons.appendChild(editBtn);
                actionButtons.appendChild(deleteBtn);

                row.appendChild(statusCheckbox);
                row.appendChild(infoContainer);
                row.appendChild(actionButtons);

                companyList.appendChild(row);
            });
        }
        
        // 새로 추가된 함수: 진행 중 상태 토글
        async function toggleInProgress(docId, isChecked) {
            const companyDocRef = doc(db, 'companies', docId);
            await updateDoc(companyDocRef, {
                inProgress: isChecked
            });
            showSaveFeedback('상태가 업데이트되었습니다.');
        }

        onSnapshot(companiesCol, (querySnapshot) => {
            displayCompanies(querySnapshot);
        });

        companyForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('companyId').value;
            const name = document.getElementById('nameInput').value;
            const category = document.getElementById('categoryInput').value;
            const email = document.getElementById('emailInput').value;
            const tel = document.getElementById('telInput').value;
            const memo = document.getElementById('memoInput').value;
            const inProgress = document.getElementById('inProgressCheckbox').checked;

            if (id) {
                const companyDocRef = doc(db, 'companies', id);
                await updateDoc(companyDocRef, {
                    name, category, email, tel, memo, inProgress
                });
                showSaveFeedback('업체 정보가 수정되었습니다!');
            } else {
                await addDoc(companiesCol, {
                    name, category, email, tel, memo, inProgress
                });
                showSaveFeedback('업체 정보가 추가되었습니다!');
            }
            closeModal();
        });

        async function openEditModal(docId, company) {
            document.getElementById('companyId').value = docId;
            document.getElementById('nameInput').value = company.name;
            document.getElementById('categoryInput').value = company.category;
            document.getElementById('emailInput').value = company.email;
            document.getElementById('telInput').value = company.tel;
            document.getElementById('memoInput').value = company.memo;
            document.getElementById('inProgressCheckbox').checked = company.inProgress || false;

            document.getElementById('modalTitle').textContent = '업체 정보 수정';
            document.getElementById('companyModal').style.display = 'flex';
        }

        async function deleteCompany(docId) {
            if (confirm('정말 삭제하시겠습니까?')) {
                await deleteDoc(doc(db, 'companies', docId));
                showSaveFeedback('업체 정보가 삭제되었습니다!');
            }
        }
    </script>
</body>
</html>
