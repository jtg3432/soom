
<script type="module">
    // ... (기존 코드 유지)
const formEl = document.getElementById('vacation-form');
    // 캘린더 렌더링 함수
    function renderCalendar() {
        calendarEl.innerHTML = `
            <div class="day-name">일</div><div class="day-name">월</div><div class="day-name">화</div><div class="day-name">수</div><div class="day-name">목</div><div class="day-name">금</div><div class="day-name">토</div>
        `;
        
        const firstDayOfMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
        const firstDayOfWeek = firstDayOfMonth.getDay();
        const lastDayOfMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0).getDate();

        monthYearEl.textContent = `${currentMonth.getFullYear()}년 ${currentMonth.getMonth() + 1}월`;

        for (let i = 0; i < firstDayOfWeek; i++) {
            calendarEl.innerHTML += `<div class="day other-month"></div>`;
        }

        for (let day = 1; day <= lastDayOfMonth; day++) {
            const dayEl = document.createElement('div');
            dayEl.className = 'day';
            dayEl.innerHTML = `<span class="day-number">${day}</span>`;
            
            const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day);
            
            // ⭐ 수정된 부분: 로컬 시간대 보정을 위한 날짜 생성
            const localDate = new Date(date.getTime() - date.getTimezoneOffset() * 60000);
            const isoDate = localDate.toISOString().split('T')[0];
            
            if (date.toDateString() === new Date().toDateString()) {
                dayEl.classList.add('today');
            }

            dayEl.onclick = () => {
                vacationDateInput.value = isoDate;
            };

            const dayVacations = allVacations.filter(v => {
                return v.date === isoDate;
            });

            dayVacations.forEach(v => {
                const vacationItem = document.createElement('div');
                vacationItem.className = 'vacation-item';
                vacationItem.textContent = `${v.name} (${v.type})`;
                
                if (v.type === '반차') vacationItem.classList.add('half-day');
                if (v.type === '병가') vacationItem.classList.add('sick-leave');
                if (v.type === '경조사') vacationItem.classList.add('family-event');
                if (v.type === '기타') vacationItem.classList.add('other');

                vacationItem.onclick = (e) => {
                    e.stopPropagation();
                    openModal(v);
                };
                dayEl.appendChild(vacationItem);
            });

            calendarEl.appendChild(dayEl);
        }
    }

    // 연차 추가
    formEl.addEventListener('submit', async (e) => {
        e.preventDefault();
        const date = document.getElementById('vacation-date').value;
        const name = document.getElementById('vacation-name').value;
        const type = document.getElementById('vacation-type').value;
        const note = document.getElementById('vacation-note').value;

        if (!date || !name || !type) {
            showMessage('날짜, 이름, 종류를 모두 입력해주세요!', 'error');
            return;
        }

        try {
            await addDoc(vacationsCollection, { date, name, type, note });
            showMessage('연차가 성공적으로 추가되었습니다!', 'success');
            formEl.reset();
        } catch (error) {
            console.error("연차 추가 실패: ", error);
            showMessage('연차 추가에 실패했습니다.', 'error');
        }
    });

    // ... (나머지 기존 코드 유지)
</script>

